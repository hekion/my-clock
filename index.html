<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Dashboard</title>
    <style>
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background-color: #000;
            color: #fff; font-family: sans-serif;
            overflow: hidden;
        }

        /* 背景 */
        #bg-img {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            z-index: -2;
            display: none;
        }
        .overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }

        @media screen and (orientation: portrait) {
            #main {
                width: 100vh; height: 100vw;
                transform: rotate(90deg) translateY(-100vw);
                transform-origin: top left;
                position: absolute;
            }
        }

        #main {
            width: 100vw; height: 100vh;
            display: flex; justify-content: space-around; align-items: center;
            padding: 20px;
        }

        /* 左側：天気と時計 */
        .left-section { text-align: center; flex: 1; text-shadow: 0 0 20px rgba(0,0,0,0.8); }
        
        /* 天気エリア */
        .weather-area { margin-bottom: 10px; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .current-weather { font-size: 2.5vh; display: flex; align-items: center; gap: 10px; }
        .forecast-row { display: flex; gap: 15px; font-size: 1.8vh; opacity: 0.9; margin-top: 5px; }

        #time { font-size: 15vh; font-weight: 300; line-height: 1; }
        #date { font-size: 4vh; margin-top: 5px; opacity: 0.8; }

        /* 右側：カレンダーと予定 */
        .side-section { width: 350px; display: flex; flex-direction: column; gap: 20px; }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-radius: 20px; padding: 15px; border: 1px solid rgba(255,255,255,0.1);
        }

        #calendar table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        td, th { text-align: center; padding: 5px; font-size: 12px; }
        .today { background: #ff4757; color: white; border-radius: 50%; font-weight: bold; }

        #todo-input {
            width: 100%; background: rgba(255,255,255,0.1); border: none;
            padding: 10px; color: white; border-radius: 10px; outline: none;
        }
        #todo-list { list-style: none; padding: 0; margin-top: 10px; max-height: 100px; overflow-y: auto; }
        li { background: rgba(0,0,0,0.3); padding: 8px; margin-bottom: 5px; border-radius: 8px; font-size: 12px; display: flex; justify-content: space-between; }

        /* 設定エリア */
        .config { position: fixed; bottom: 20px; right: 20px; z-index: 100; display: flex; gap: 10px; }
        .btn { cursor: pointer; background: rgba(255,255,255,0.3); padding: 10px 15px; border-radius: 30px; font-size: 11px; border: 1px solid #fff; }
        select { background: rgba(0,0,0,0.5); color: #fff; border: 1px solid #fff; border-radius: 5px; padding: 5px; }
    </style>
</head>
<body>

<img id="bg-img" src="">
<div class="overlay"></div>

<div id="main">
    <div class="left-section">
        <div class="weather-area">
            <div class="current-weather">
                <span id="city-name">東京</span>
                <span id="curr-icon">☀️</span>
                <span id="curr-temp">25°C</span>
                <span id="curr-range" style="font-size: 0.8em; opacity: 0.7;">H: 28° L: 18°</span>
            </div>
            <div class="forecast-row">
                <div id="day-1">明日: ☁️ 22°/15°</div>
                <div id="day-2">明後日: ☔ 19°/14°</div>
            </div>
        </div>

        <div id="time">00:00:00</div>
        <div id="date">0000.00.00 ---</div>
    </div>

    <div class="side-section">
        <div class="card" id="calendar">
            <div id="m-y" style="text-align:center; font-weight:bold;"></div>
            <table>
                <thead><tr><th>日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th></tr></thead>
                <tbody id="cal-body"></tbody>
            </table>
        </div>
        <div class="card">
            <input type="text" id="todo-input" placeholder="予定を追加...">
            <ul id="todo-list"></ul>
        </div>
    </div>
</div>

<div class="config">
    <select id="city-select">
        <option value="Tokyo">東京</option>
        <option value="Osaka">大阪</option>
        <option value="Nagoya">名古屋</option>
        <option value="Sapporo">札幌</option>
        <option value="Fukuoka">福岡</option>
    </select>
    <label class="btn" for="up">背景変更</label>
    <input type="file" id="up" accept="image/*" style="display:none">
</div>

<script>
    // 1. 時計
    function updateClock() {
        const n = new Date();
        document.getElementById('time').textContent = n.toLocaleTimeString('ja-JP', { hour12: false });
        const d = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
        document.getElementById('date').textContent = `${n.getFullYear()}.${n.getMonth()+1}.${n.getDate()} ${d[n.getDay()]}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // 2. カレンダー
    function drawCalendar() {
        const n = new Date(), y = n.getFullYear(), m = n.getMonth();
        document.getElementById('m-y').textContent = `${y}年 ${m + 1}月`;
        const f = new Date(y, m, 1).getDay(), l = new Date(y, m + 1, 0).getDate();
        const b = document.getElementById('cal-body'); b.innerHTML = '';
        let d = 1;
        for (let i = 0; i < 6; i++) {
            let r = document.createElement('tr');
            for (let j = 0; j < 7; j++) {
                let c = document.createElement('td');
                if (i === 0 && j < f || d > l) { c.textContent = ''; }
                else {
                    c.textContent = d;
                    if (d === n.getDate()) c.className = 'today';
                    d++;
                }
                r.appendChild(c);
            }
            b.appendChild(r); if (d > l) break;
        }
    }
    drawCalendar();

    // 3. 背景画像 (URL.createObjectURL)
    const up = document.getElementById('up');
    const bgImg = document.getElementById('bg-img');
    up.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const url = URL.createObjectURL(file);
            bgImg.src = url;
            bgImg.style.display = 'block';
            const reader = new FileReader();
            reader.onload = (ev) => {
                try { localStorage.setItem('user_bg', ev.target.result); } catch(err) {}
            };
            reader.readAsDataURL(file);
        }
    };
    const saved = localStorage.getItem('user_bg');
    if (saved) { bgImg.src = saved; bgImg.style.display = 'block'; }

    // 4. 天気（サンプルデータ）
    const citySelect = document.getElementById('city-select');
    citySelect.onchange = () => {
        const city = citySelect.options[citySelect.selectedIndex].text;
        document.getElementById('city-name').innerText = city;
        // 本来はここでAPIを叩いてデータを更新します
        console.log(city + "の天気を取得中...");
    };

    // 5. 予定リスト
    const input = document.getElementById('todo-input');
    const list = document.getElementById('todo-list');
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && input.value.trim()) {
            const li = document.createElement('li');
            li.innerHTML = `<span>${input.value}</span><span style="cursor:pointer">✕</span>`;
            li.onclick = () => li.remove();
            list.appendChild(li);
            input.value = '';
        }
    });
</script>
</body>
</html>
