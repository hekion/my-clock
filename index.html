<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Clock</title>
    <style>
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background-color: #000; /* ç”»åƒãŒãªã„æ™‚ã®åŸºæœ¬è‰² */
            color: #fff; font-family: sans-serif; overflow: hidden;
        }

        /* èƒŒæ™¯ç”»åƒã‚’bodyå…¨ä½“ã«ç›´æ¥è¡¨ç¤ºã™ã‚‹ */
        #bg-image {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover; background-position: center;
            z-index: -2; /* æœ€èƒŒé¢ */
        }

        /* èƒŒæ™¯ã‚’æš—ãã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆç”»åƒã®ä¸Šã«è¢«ã›ã‚‹ï¼‰ */
        .dim-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); /* æš—ã•ã‚’èª¿æ•´ */
            z-index: -1; 
        }

        @media screen and (orientation: portrait) {
            #main-wrapper {
                width: 100vh; height: 100vw;
                transform: rotate(90deg); transform-origin: bottom left;
                position: absolute; top: -100vw; left: 0;
            }
        }

        #main-wrapper {
            width: 100vw; height: 100vh;
            display: flex; flex-direction: row;
            justify-content: space-around; align-items: center;
            padding: 20px;
            position: relative; z-index: 1;
        }

        .clock-box { text-align: center; text-shadow: 0 0 20px rgba(0,0,0,0.8); flex: 1; }
        #clock { font-size: 15vh; font-weight: 300; }
        #date { font-size: 4vh; opacity: 0.8; }

        .side-box { width: 350px; display: flex; flex-direction: column; gap: 15px; }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-radius: 15px; padding: 15px; border: 1px solid rgba(255,255,255,0.1);
        }

        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        td, th { text-align: center; padding: 4px; }
        .today { background: #ff4757; color: #fff; border-radius: 50%; font-weight: bold; }

        input {
            width: 100%; background: rgba(255,255,255,0.2); border: none;
            padding: 10px; color: #fff; border-radius: 8px; outline: none;
        }
        ul { list-style: none; padding: 0; margin: 10px 0 0; max-height: 80px; overflow-y: auto; }
        li { background: rgba(0,0,0,0.3); padding: 8px; margin-bottom: 5px; border-radius: 5px; font-size: 12px; display: flex; justify-content: space-between; }

        .config { position: fixed; bottom: 20px; right: 20px; z-index: 100; }
        .btn { cursor: pointer; background: rgba(255,255,255,0.4); padding: 10px 15px; border-radius: 10px; font-size: 12px; border: 1px solid #fff; }
    </style>
</head>
<body>

<div id="bg-image"></div>
<div class="dim-overlay"></div>

<div id="main-wrapper">
    <div class="clock-box">
        <div id="clock">00:00:00</div>
        <div id="date">----.--.-- ---</div>
    </div>
    <div class="side-box">
        <div class="card">
            <div id="m-y" style="text-align:center; font-weight:bold; margin-bottom:5px;"></div>
            <table>
                <thead><tr><th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th></tr></thead>
                <tbody id="cal"></tbody>
            </table>
        </div>
        <div class="card">
            <input type="text" id="in" placeholder="äºˆå®šã‚’è¿½åŠ ...">
            <ul id="list"></ul>
        </div>
    </div>
</div>

<div class="config">
    <label class="btn" for="up">ğŸ“· èƒŒæ™¯ç”»åƒã‚’å¤‰æ›´</label>
    <input type="file" id="up" accept="image/*" style="display:none">
</div>

<script>
    // 1. æ™‚è¨ˆ
    function tick() {
        const n = new Date();
        document.getElementById('clock').textContent = n.toLocaleTimeString('ja-JP', { hour12: false });
        const d = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
        document.getElementById('date').textContent = `${n.getFullYear()}.${String(n.getMonth()+1).padStart(2,'0')}.${String(n.getDate()).padStart(2,'0')} ${d[n.getDay()]}`;
    }
    setInterval(tick, 1000); tick();

    // 2. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
    function draw() {
        const n = new Date(), y = n.getFullYear(), m = n.getMonth();
        document.getElementById('m-y').textContent = `${y}å¹´ ${m + 1}æœˆ`;
        const f = new Date(y, m, 1).getDay(), l = new Date(y, m + 1, 0).getDate();
        const b = document.getElementById('cal'); b.innerHTML = '';
        let d = 1;
        for (let i = 0; i < 6; i++) {
            let r = document.createElement('tr');
            for (let j = 0; j < 7; j++) {
                let c = document.createElement('td');
                if (i === 0 && j < f || d > l) { c.textContent = ''; }
                else {
                    c.textContent = d;
                    if (d === n.getDate()) c.className = 'today';
                    d++;
                }
                r.appendChild(c);
            }
            b.appendChild(r); if (d > l) break;
        }
    }
    draw();

    // 3. èƒŒæ™¯ç”»åƒï¼ˆãƒªã‚µã‚¤ã‚ºï¼†åæ˜ ï¼‰
    const up = document.getElementById('up');
    const bgDiv = document.getElementById('bg-image');

    up.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (re) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const MAX_W = 1280;
                let w = img.width, h = img.height;
                if (w > MAX_W) { h = h * (MAX_W / w); w = MAX_W; }
                canvas.width = w; canvas.height = h;
                ctx.drawImage(img, 0, 0, w, h);
                
                const dataURL = canvas.toDataURL('image/jpeg', 0.8);
                bgDiv.style.backgroundImage = `url(${dataURL})`;
                
                try {
                    localStorage.setItem('user_bg', dataURL);
                } catch(e) {
                    console.log("Storage full, but image displayed.");
                }
            };
            img.src = re.target.result;
        };
        reader.readAsDataURL(file);
    };

    // ä¿å­˜æ¸ˆã¿ç”»åƒã®å¾©å…ƒ
    const saved = localStorage.getItem('user_bg');
    if(saved) {
        bgDiv.style.backgroundImage = `url(${saved})`;
    }

    // 4. äºˆå®šãƒªã‚¹ãƒˆ
    const i = document.getElementById('in'), l = document.getElementById('list');
    i.onkeypress = (e) => {
        if (e.key === 'Enter' && i.value.trim()) {
            const li = document.createElement('li');
            li.innerHTML = `<span>${i.value}</span><span style="cursor:pointer; padding: 0 5px;">âœ•</span>`;
            li.onclick = () => li.remove();
            l.appendChild(li); i.value = '';
        }
    };
</script>
</body>
</html>
