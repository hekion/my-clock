<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Clock</title>
    <style>
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background-color: #000;
            color: #fff; font-family: sans-serif;
            overflow: hidden;
        }

        /* 背景：imgタグを使って直接表示（これが一番確実です） */
        #bg-img {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            z-index: -2;
            display: none; /* 画像がない時は非表示 */
        }

        .dim {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }

        @media screen and (orientation: portrait) {
            #main {
                width: 100vh; height: 100vw;
                transform: rotate(90deg) translateY(-100vw);
                transform-origin: top left;
            }
        }

        #main {
            width: 100vw; height: 100vh;
            display: flex; justify-content: space-around; align-items: center;
            padding: 20px;
        }

        .clock { text-align: center; flex: 1; }
        #time { font-size: 15vh; }
        #date { font-size: 4vh; opacity: 0.8; }

        .side { width: 320px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 15px; border-radius: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
        td, th { text-align: center; padding: 5px; }
        .today { background: #ff4757; color: #fff; border-radius: 50%; }

        .config { position: fixed; bottom: 20px; right: 20px; }
        .btn { background: rgba(255,255,255,0.3); color: #fff; padding: 10px 15px; border-radius: 10px; cursor: pointer; border: 1px solid #fff; font-size: 12px; }
    </style>
</head>
<body>

<img id="bg-img" src="">
<div class="dim"></div>

<div id="main">
    <div class="clock">
        <div id="time">00:00:00</div>
        <div id="date">0000.00.00 ---</div>
    </div>
    <div class="side">
        <div id="m-y" style="text-align:center; font-weight:bold;"></div>
        <table>
            <thead><tr><th>日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th></tr></thead>
            <tbody id="cal"></tbody>
        </table>
    </div>
</div>

<div class="config">
    <label class="btn" for="up">背景選択</label>
    <input type="file" id="up" accept="image/*" style="display:none">
</div>

<script>
    function tick() {
        const n = new Date();
        document.getElementById('time').textContent = n.toLocaleTimeString('ja-JP', { hour12: false });
        const d = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
        document.getElementById('date').textContent = `${n.getFullYear()}.${n.getMonth()+1}.${n.getDate()} ${d[n.getDay()]}`;
    }
    setInterval(tick, 1000); tick();

    function draw() {
        const n = new Date(), y = n.getFullYear(), m = n.getMonth();
        document.getElementById('m-y').textContent = `${y}年 ${m + 1}月`;
        const f = new Date(y, m, 1).getDay(), l = new Date(y, m + 1, 0).getDate();
        const b = document.getElementById('cal'); b.innerHTML = '';
        let d = 1;
        for (let i = 0; i < 6; i++) {
            let r = document.createElement('tr');
            for (let j = 0; j < 7; j++) {
                let c = document.createElement('td');
                if (i === 0 && j < f || d > l) { c.textContent = ''; }
                else {
                    c.textContent = d;
                    if (d === n.getDate()) c.className = 'today';
                    d++;
                }
                r.appendChild(c);
            }
            b.appendChild(r); if (d > l) break;
        }
    }
    draw();

    const up = document.getElementById('up');
    const bgImg = document.getElementById('bg-img');

    up.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (ev) => {
            bgImg.src = ev.target.result;
            bgImg.style.display = 'block';
            try { localStorage.setItem('bg_data', ev.target.result); } catch(err) {}
        };
        reader.readAsDataURL(file);
    };

    const saved = localStorage.getItem('bg_data');
    if (saved) {
        bgImg.src = saved;
        bgImg.style.display = 'block';
    }
</script>
</body>
</html>
